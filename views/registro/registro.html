<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro de Cuenta</title>
    <link rel="stylesheet" href=/css/registro/registro.css>
  </head>
  <body>
    <div class="banner">
      <div class="formulario">
        <div class="titulo" style="display: flex; justify-content: center">
          <span style="font-size: 24px; color: white">Registro de Cuenta</span>
        </div>
        <div class="campos">
          <form id="form-register">
            <div class="inputs-row">
              <div class="input-container">
                <label for="dni">Número de DNI</label>
                <input type="number" name="dni" id="dni" required />
              </div>
              <div class="separador"></div>
              <div class="input-container">
                <label for="email">Correo</label>
                <input type="email" name="email" id="email" required />
              </div>
            </div>
            <div class="separador"></div>
            <div class="input-container">
              <label for="type-user">Tipo de usuario</label>
              <select name="tipoUsuario" id="type-user">
                <option value="paciente">Paciente</option>
                <option value="doctor">Doctor</option>
              </select>
            </div>
            <div class="separador"></div>
            <div class="inputs-row">
              <div class="input-container">
                <label for="phone">Número de Celular</label>
                <input type="tel" name="phone" id="phone" required />
              </div>
              <div class="separador"></div>
              <div class="input-container">
                <label class="p_paciente" for="phone-family"
                  >Celular de Pariente</label
                >
                <input
                  class="p_paciente"
                  type="tel"
                  name="phoneFamily"
                  id="phonefamily2"
                  required
                />

                <label class="p_doctor" for="year-xp"
                  >Años de Experiencia</label
                >
                <input
                  class="p_doctor"
                  type="number"
                  name="yearXp"
                  id="year-xp"
                  required
                />
              </div>
            </div>
            <div class="separador"></div>
            <div class="input-container">
              <label class="p_paciente" for="address">Dirección</label>
              <input
                class="p_paciente"
                type="text"
                name=""
                id="address"
                required
              />

              <label class="p_doctor" for="specialty">Especialidad</label>
              <input class="p_doctor type="number" name="specialty"
              id="specialty" required>
            </div>
            <div class="separador"></div>
            <div class="inputs-row">
              <div class="input-container">
                <label for="password">Contraseña</label>
                <input type="password" name="" id="password" required />
              </div>
              <div class="separador"></div>
              <div class="input-container">
                <label for="re-password">Confirmar contraseña</label>
                <input
                  type="password"
                  name="password"
                  id="re-password"
                  required
                />
              </div>
            </div>
            <div class="separador"></div>
            <div style="display: flex; align-items: center">
              <input type="checkbox" name="" id="confirm" />
              <label for="confirm"
                >Acepto los Términos de uso y Políticas de Privacidad</label
              >
            </div>
          </form>
        </div>
        <div class="acciones">
          <button class="b-outline btn-flex">Cancelar</button>
          <div class="separador"></div>
          <button
            class="b-solid btn-flex"
            type="submit"
            form="form-register"
            id="submit"
          >
            Registrar
          </button>
        </div>
      </div>
      <div class="logo">
        <img src="/imagenes/LogoTingo.png" />
      </div>
    </div>
    <script>
      const type_user = document.getElementById("type-user");
      const p_paciente = document.getElementsByClassName("p_paciente");
      const p_doctor = document.getElementsByClassName("p_doctor");
      type_user.addEventListener("change", () => {
        console.log(type_user.value);
        if (type_user.value == "paciente") {
          for (let p_p of p_paciente) {
            p_p.style.display = "block";
          }
          for (let p_d of p_doctor) {
            p_d.style.display = "none";
          }
        } else if (type_user.value == "doctor") {
          for (let p_d of p_doctor) {
            p_d.style.display = "block";
          }
          for (let p_p of p_paciente) {
            p_p.style.display = "none";
          }
        }
      });
    </script>
    <script>
      const form = document.querySelector("form");

      const submit = document.getElementById("submit");
      submit.addEventListener("click", enviarDatos);

      async function enviarDatos(e) {
        e.preventDefault();
        let datosUsuario = null;
        if(form.tipoUsuario.value=="paciente"){
            datosUsuario = getDatosPaciente();
        }else if(form.tipoUsuario.value=="doctor"){
            datosUsuario = getDatosDoctor();
        }
        
        const res = await fetch("/registro", {
          method: "POST",
          body: JSON.stringify(datosUsuario),
          headers: { "Content-Type": "application/json" },
        });
        const data = await res.json();
        console.log(data);
      }

      function getDatosComunes() {
        const datos = {};
        datos.nombre = " n";
        datos.apellido = " a ";
        datos.dni = form.dni.value;
        datos.email = form.email.value;
        datos.tipoUsuario = form.tipoUsuario.value;
        datos.telefono = form.phone.value;
        datos.password = form.password[0].value;
        return datos;
      }
      function getDatosDoctor() {
        const datos = getDatosComunes();
        datos.yearXp = form.yearXp.value;
        datos.especialidad = form.specialty.value;
        return datos;
      }

      function getDatosPaciente() {
        const datos = getDatosComunes();
        datos.telefonoFamiliar = form.phoneFamily.value;
        datos.direccion = form.address.value;
        return datos;
      }
    </script>
  </body>
</html>
